import{r as N,j as e,c as M,R}from"./client-DD4c7S6m.js";const k=s=>s.product.price*s.quantity,E=s=>{const{product:c,quantity:d}=s,o=Q(s);return o?c.price*d*(1-o):k(s)},Q=s=>{const{product:c,quantity:d}=s,p=c.discounts.sort((r,x)=>x.quantity-r.quantity).find(r=>r.quantity<=d);return(p==null?void 0:p.rate)||0},B=(s,c)=>{if(!c)return s;const{discountType:d,discountValue:o}=c;return d==="amount"?s-o:s*(1-o/100)},L=(s,c)=>{const d=s.reduce((r,x)=>r+k(x),0),o=s.reduce((r,x)=>r+E(x),0),p=B(o,c);return{totalBeforeDiscount:d,totalAfterDiscount:p,totalDiscount:d-p}},S=(s,c)=>s.filter(d=>d.product.id!==c),U=(s,c)=>{const d=s.product.stock,o=Math.max(0,Math.min(c,d));return{...s,quantity:o}},O=(s,c,d)=>s.map(o=>o.product.id===c?U(o,d):o),W=(s,c,d)=>d<=0?S(s,c):O(s,c,d),_=()=>{const[s,c]=N.useState([]),[d,o]=N.useState(null),p=m=>{if(s.some(u=>u.product.id===m.id)){const u=s.find(y=>y.product.id===m.id).quantity+1;return x(m.id,u)}return c(u=>[...u,{product:m,quantity:1}])},r=m=>{const j=S(s,m);c(j)},x=(m,j)=>{c(u=>W(u,m,j))};return{cart:s,addToCart:p,removeFromCart:r,updateQuantity:x,applyCoupon:m=>o(m),calculateTotal:()=>{const{totalBeforeDiscount:m,totalAfterDiscount:j,totalDiscount:u}=L(s,d);return{totalBeforeDiscount:m,totalAfterDiscount:j,totalDiscount:u}},selectedCoupon:d}},z=s=>{const[c,d]=N.useState(s);return{coupons:c,addCoupon:p=>{d(r=>[...r,p])}}},G=s=>{const[c,d]=N.useState(s);return{products:c,updateProduct:r=>{const x=c.map(i=>r.id===i.id?r:i);d(x)},addProduct:r=>{d(x=>[...x,r])}}},H=({products:s,coupons:c})=>{const{cart:d,addToCart:o,removeFromCart:p,updateQuantity:r,applyCoupon:x,calculateTotal:i,selectedCoupon:b}=_(),m=n=>n.reduce((l,v)=>Math.max(l,v.rate),0),j=n=>{const l=d.find(v=>v.product.id===n.id);return n.stock-((l==null?void 0:l.quantity)||0)},{totalBeforeDiscount:u,totalAfterDiscount:y,totalDiscount:w}=i(),C=n=>{const{discounts:l}=n.product,{quantity:v}=n;let f=0;for(const P of l)v>=P.quantity&&(f=Math.max(f,P.rate));return f};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:s.map(n=>{const l=j(n);return e.jsxs("div",{"data-testid":`product-${n.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:n.name}),e.jsxs("span",{className:"text-gray-600",children:[n.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${l>0?"text-green-600":"text-red-600"}`,children:["재고: ",l,"개"]}),n.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(m(n.discounts)*100).toFixed(0),"% 할인"]})]}),n.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:n.discounts.map((v,f)=>e.jsxs("li",{children:[v.quantity,"개 이상: ",(v.rate*100).toFixed(0),"% 할인"]},f))}),e.jsx("button",{onClick:()=>o(n),className:`w-full px-3 py-1 rounded ${l>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:l<=0,children:l>0?"장바구니에 추가":"품절"})]},n.id)})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:d.map(n=>{const l=C(n);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:n.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[n.product.price,"원 x ",n.quantity,l>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(l*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>r(n.product.id,n.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>r(n.product.id,n.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>p(n.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},n.product.id)})}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:n=>x(c[parseInt(n.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),c.map((n,l)=>e.jsxs("option",{value:l,children:[n.name," - ",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`]},n.code))]}),b&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",b.name,"(",b.discountType==="amount"?`${b.discountValue}원`:`${b.discountValue}%`," 할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",u.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",w.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",y.toLocaleString(),"원"]})]})]})]})]})]})},J=({products:s,coupons:c,onProductUpdate:d,onProductAdd:o,onCouponAdd:p})=>{const[r,x]=N.useState(new Set),[i,b]=N.useState(null),[m,j]=N.useState({quantity:0,rate:0}),[u,y]=N.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[w,C]=N.useState(!1),[n,l]=N.useState({name:"",price:0,stock:0,discounts:[]}),v=t=>{x(h=>{const a=new Set(h);return a.has(t)?a.delete(t):a.add(t),a})},f=t=>{b({...t})},P=(t,h)=>{if(i&&i.id===t){const a={...i,name:h};b(a)}},q=(t,h)=>{if(i&&i.id===t){const a={...i,price:h};b(a)}},D=()=>{i&&(d(i),b(null))},T=(t,h)=>{const a=s.find(g=>g.id===t);if(a){const g={...a,stock:h};d(g),b(g)}},A=t=>{const h=s.find(a=>a.id===t);if(h&&i){const a={...h,discounts:[...h.discounts,m]};d(a),b(a),j({quantity:0,rate:0})}},I=(t,h)=>{const a=s.find(g=>g.id===t);if(a){const g={...a,discounts:a.discounts.filter((Z,F)=>F!==h)};d(g),b(g)}},V=()=>{p(u),y({name:"",code:"",discountType:"percentage",discountValue:0})},$=()=>{const t={...n,id:Date.now().toString()};o(t),l({name:"",price:0,stock:0,discounts:[]}),C(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>C(!w),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:w?"취소":"새 상품 추가"}),w&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:n.name,onChange:t=>l({...n,name:t.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:n.price,onChange:t=>l({...n,price:parseInt(t.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:n.stock,onChange:t=>l({...n,stock:parseInt(t.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:$,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),e.jsx("div",{className:"space-y-2",children:s.map((t,h)=>e.jsxs("div",{"data-testid":`product-${h+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>v(t.id),className:"w-full text-left font-semibold",children:[t.name," - ",t.price,"원 (재고: ",t.stock,")"]}),r.has(t.id)&&e.jsx("div",{className:"mt-2",children:i&&i.id===t.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:i.name,onChange:a=>P(t.id,a.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:i.price,onChange:a=>q(t.id,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:i.stock,onChange:a=>T(t.id,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),i.discounts.map((a,g)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[a.quantity,"개 이상 구매 시 ",a.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>I(t.id,g),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},g)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:m.quantity,onChange:a=>j({...m,quantity:parseInt(a.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:m.rate*100,onChange:a=>j({...m,rate:parseInt(a.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>A(t.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:D,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[t.discounts.map((a,g)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[a.quantity,"개 이상 구매 시 ",a.rate*100,"% 할인"]})},g)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>f(t),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:u.name,onChange:t=>y({...u,name:t.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:u.code,onChange:t=>y({...u,code:t.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:u.discountType,onChange:t=>y({...u,discountType:t.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:u.discountValue,onChange:t=>y({...u,discountValue:parseInt(t.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:V,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:c.map((t,h)=>e.jsxs("div",{"data-testid":`coupon-${h+1}`,className:"bg-gray-100 p-2 rounded",children:[t.name," (",t.code,"):",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`," 할인"]},h))})]})]})]})]})]})},K=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],X=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],Y=()=>{const{products:s,updateProduct:c,addProduct:d}=G(K),{coupons:o,addCoupon:p}=z(X),[r,x]=N.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>x(!r),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:r?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:r?e.jsx(J,{products:s,coupons:o,onProductUpdate:c,onProductAdd:d,onCouponAdd:p}):e.jsx(H,{products:s,coupons:o})})]})};M.createRoot(document.getElementById("root")).render(e.jsx(R.StrictMode,{children:e.jsx(Y,{})}));
